<!DOCTYPE html>
<html>
  <head>
    <base target="_top">

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
      body{
        padding: 20px;
      }
    </style>

  </head>
  <body>

      
    <div class="container">
      <!-- Content here -->
      <h2>Subir archivos</h2>

      <div class="mb-3">
        <label for="formFile" class="form-label">Sube aquí tu archivo:</label>
        <input class="form-control" type="file" id="uploadinput">
      </div>

      <div id="preview" class="mb-3"></div>

      <button type="button" class="btn btn-primary" id="btn-submit">Subir</button>

    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>
      
      document.getElementById("uploadinput").addEventListener("change", handleFiles, false);

      var button = document.getElementById('btn-submit');
      button.addEventListener('click', uploadfile);

      function handleFiles(f) {
        var previewDiv = document.getElementById('preview').innerHTML = '';
        const files = document.getElementById("uploadinput").files;

        for (var i = 0; i < files.length; i++) {
          var file = files[i];
          var imageType = /image.*/;

          if (!file.type.match(imageType)) {
            continue;
          }

          var img = document.createElement("img");
          img.classList.add("obj");
          img.file = file;
          preview.appendChild(img);

          var reader = new FileReader();
          reader.onload = (function(aImg) { return function(e) { aImg.src = e.target.result; }; })(img);
          reader.readAsDataURL(file);
        }
      }
      
      function uploadfile(){
        const selectedfile = document.getElementById('uploadinput').files[0];
        // console.log(selectedfile);
        const imgs = document.querySelectorAll('.obj');

        for(let i = 0; i < imgs.length; i++){
          new FileUpload(imgs[i], imgs[i].file);
          // console.log(imgs[i], imgs[i].file);
        }
      }

      function FileUpload(img, file){
        var reader = new FileReader();
        reader.onload = function(event) {
          // El texto del archivo se mostrará por consola aquí
          // console.log(event.target.result);
          const obj ={
            filename: file.name,
            mimeType:file.type,
            bytes: [...new Int8Array(event.target.result)]
          };
          // console.log(obj.bytes);
          google.script.run
          .withSuccessHandler((e) => console.log(e))
          .uploadfiles(obj);
        };

        reader.readAsArrayBuffer(file);
      }

    </script>

  </body>
</html>